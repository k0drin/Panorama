<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ panorama.title }}</title>
    <link href="https://unpkg.com/photo-sphere-viewer@4/dist/photo-sphere-viewer.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://unpkg.com/photo-sphere-viewer@4/dist/photo-sphere-viewer.min.js"></script>
</head>
<body>
    <h1>{{ panorama.title }}</h1>
    <p>{{ panorama.description }}</p>
    <div id="viewer" style="width: 100%; height: 500px;"></div>

    <script>
        const viewer = new PhotoSphereViewer.Viewer({
            container: document.querySelector('#viewer'),
            panorama: "{{ panorama.image.url }}",
            plugins: [
                [PhotoSphereViewer.MarkersPlugin, {}],
            ],
        });

        const markers = {{ markers_json|safe }};

        markers.forEach(marker => {
            viewer.getPlugin(PhotoSphereViewer.MarkersPlugin).addMarker({
                id: marker.id,
                longitude: marker.x_coordinate,
                latitude: marker.y_coordinate,
                tooltip: marker.tooltip_text,
                link: marker.linked_panorama_url,
            });
        });

        viewer.on('select-marker', (e, marker) => {
            if (marker.data.link) {
                window.location.href = marker.data.link;
            }
        });
    </script>
</body>
</html>
